<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SplitMate</title>
    <link rel="stylesheet" href="profile.css">
    <style>
        html{
    scroll-behavior: smooth;
}
body {
  background-image: url("./splitMate.jpg");
  background-size: cover;
  background-repeat: no-repeat;
  background-attachment: fixed;
  margin: 0px; 
  padding: 0px;
} 

.container {
    margin-top: 10%;
    margin-left: 27%;
    margin-bottom: 10%;
    width: 600px;
    background-color: white;
    padding: 20px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
}

h1 {
    text-align: center;
    margin-bottom: 20px;
}

input {
    width: calc(100% - 22px);
    padding: 10px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    display: block;
}

#button1 {
    width: 100%;
    padding: 10px;
    background-color: #28a745;
    border: none;
    color: white;
    font-size: 16px;
    border-radius: 4px;
    cursor: pointer;
}

#button1:hover {
    background-color: #218838;
}

#expense-list {
    margin-top: 20px;
}

.expense-item {
    background-color: #f8f9fa;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    margin-bottom: 10px;
}
                            /* Profile Data*/
#profileButton {
    background-color: transparent;
    margin-top: -10px;
    color: white;
    border: none;
    cursor: pointer;
}

.popup {
    display: none;
    position: fixed;
    top: 35%;
    left: 90%;
    transform: translate(-50%, -50%);
    background-color:transparent blue;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border-radius: 10%;
    border: 2px solid white;
    z-index: 1000;
}

.popup.active {
    display: block;
}

        #logoutButton {
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            background-color: #d9534f;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            z-index: 1001;
        }

        #logoutButton:hover {
            background-color: darkred;
        }
        .profile-info {
            display: flex;
            flex-direction: column; /* Display name and email in a column */
            padding-top: 2%;
            padding-bottom: 2%;
            margin-bottom: 1rem;
            border-bottom: 3px solid black
        }
        
        .profile-label {
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .popup {
                position: absolute;
                    left: 30%;
                    top: 40%;
                    width: 50vw; /* Adjust for smaller screens */
            }
        }


        /*                  Navbar                */

#nav{
    justify-content: right;
    background-color: rgba(30, 40, 78, 0.5);
    display: flex;
    padding: 25px;
    position: relative;
    flex-direction: row;
    padding: 20px;
    margin: 0px;
    border-bottom-left-radius: 200px;
    border-bottom-right-radius: 200px;
}

#logo{
    padding: 0px;
    margin-left: 20%;
    position: relative;
    left: 30px;
    border-radius: 20%;
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 2);
    animation: leftani 1s ease forwards;
    animation-delay: calc(.2s * var(--leftani));
}

.nav-items{
    display: flex;
    flex-direction: row;
    gap: 27%;
    margin: 1% auto auto 15.2%;
    padding: 0% 23.5% 0% 0%;
    animation: SocialAni 1s ease forwards;
    animation-delay: calc(.2s * var(--socialAni));
}

.navopt{
    border: 10px;
    border-radius: 25%;
    padding: 7px, 15px 7px 15px;
    border-radius: 20px;
    color: White;
    align-items: right;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 100);
    margin: 0% ;
    font-size: 18px;
    text-decoration: none;
    font-family: Georgia, serif;
}

.user-info{
    margin-left: -50%;
}

.user-info-text{
    color: white;
    font-size: 20px;
    margin: 0px;
    padding: 0px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 2);

}

.navopt::after {
    content: "";
    display: block;
    display: flex;
    height: 2px;
    width: 0;
    background-color: #f1f1f1;
    transition: width .3s;
}

.user-info{
    position: relative;
    left: 30px;
}

.navopt:hover::after {
    width: 100%;
}
.delete-button{
            background-color: #f44336;
                color: white;
                padding: 5px 8px 5px 8px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
                cursor: pointer;
                border-radius: 10px;
        }

        .delete-button:hover{
            background-color: red;
        }


/*              Mobile Menu Styling            */

.mobile-menu-icon {
    display: none;
    flex-direction: column;
    cursor: pointer;
    margin-left: 60%;
    margin-top: 3%;
}

.mobile-menu-icon span {
    height: 2px;
    width: 20px;
    background-color: white;
    margin: 3px;
    display: block;
    
}

@media(max-width: 800px) {
    
    #logo{
        align-content: left;
        padding: 0px;
        margin-right: 10%;
        border-radius: 20%;
    }   
    
    .nav-items {
        display: none;
        flex-direction: column;
        width: 80px;
        text-align: center;
        position: absolute;
        top: 90px;
        left: 50%;
        background-color: rgba(30, 40, 78, 0.5);
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;

    }

    .nav-items.show {
        align-items: center;
        display: flex;
        margin-right: 10%;
        padding-right: 10px;
        padding-left: 10px;
    }

    .navopt {
        align-content: center;
        padding: 10px;
        display: block;
        color: white;
        margin-bottom: 0px;
        padding-bottom: 0px;
    }

    .mobile-menu-icon {
        display: flex;
        margin-right: 10%;
        margin-bottom: 0px;
        padding-bottom: 0px;
    }
}


@media(max-width: 500px) {
    
    #logo{
        align-content: left;
        padding: 0px;
        margin-right: -8%;
        border-radius: 20%;
    }   
    
    .nav-items {
        display: none;
        flex-direction: column;
        width: 75px;
        text-align: center;
        position: absolute;
        top: 88px;
        left: 60%;
        background-color: rgba(30, 40, 78, 0.5);
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;

    }

    .nav-items.show {
        display: flex;
        align-items: center;
        margin-right: 10px;
        padding-right: 10px;
    }

    .navopt {
        padding: 10px;
        display: block;
        color: white;
    }

    .mobile-menu-icon {
        display: flex;
        margin-right: 10%;
        margin-bottom: 0px;
        padding-bottom: 0px;
    }

    /*responsive style*/
    @media (max-width: 768px) {
    .container {
        margin-top: 8%;
        width: 85%;
        margin-left: 2%;
        margin-bottom: 8%;
    }
}
}
/*          Footer          */

footer {
    background-color: #333;
    background-color: rgba(30, 40, 78, 0.5);
    border-top-right-radius: 180px;
    border-top-left-radius: 180px;
    color: #fff;
    padding: 10px;
    text-align: center;
}

.footer-columns {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    padding-bottom: 0;
}


.footer-column1 {
    flex: 1;
    margin: 1%;
    margin-left: 14%;
}

.footer-column1 > h3{
    font-size: 30px;
    padding: 0px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 2);
    margin: 0px;
}

.footer-column1 > p{
    margin: 4%;
    font-size: 20px;
    padding: 0;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 2);
}

.footer-column1 > p > a:hover{
    color:#C7C8CC;
}

.footer-column1 > p > a{
    color: #ffff;
    text-decoration: none;
    
}


.footer-column2 {
    flex: 0.6;
    margin: 1%;
}

.footer-column2 > ul{
    list-style-type: none;
    padding: 0px;
    margin: 0px
} 

.footer-column2 > ul > li{
    margin: 4.6%;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 2);
}

.footer-column2 > ul > li > a{
    color: #ffff;
    text-decoration: none;
    font-size: 22px;
}

.footer-column2 > ul > li > a:hover{
    color: #C7C8CC;
}

.footer-column3 {
    flex: 1;
    margin: 1%;
    margin-right: 14%;
}

.footer-column3 > img{
    height: 80px;
    box-shadow: 2px 2px 4px rgba(0, 0, 0, 2);
    border-radius: 20px;
    width: 80px;
}

.footer-column3 > p{
    font-size: 25px;
    margin: 0% 3% 0% 3%;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 2);
}

.foot-list{
    color: #ffff;
    list-style: none;
}

@media (max-width: 700px) {
    .footer-column1,
    .footer-column2,
    .footer-column3 {
        flex: 100%;
        margin: 1% 0;
    }

    .footer-column1 {
        margin-left: 0;
    }

    .footer-column2 > ul > li > a:hover{
        color:#C7C8CC;
    }
}
#loading-message {
  display: none;
  text-align: center;
  font-family: 'Arial', sans-serif;
  color: #ffffff;
  background-color: #007BFF;
  padding: 10px;
  border-radius: 5px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  animation: fadeIn 1s ease-in-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}#success-message, #error-message {
  display: none;
  text-align: center;
  font-weight: bold;
  margin: 10px 0;
  font-size: 18px;
}

#success-message {
  color: #28a745;
}

#error-message {
  color: #dc3545;
}


    </style>
</head>
</head>
<body>
      
    <header class="container1">
        <nav id="nav">
            <a href="/home"><img id="logo" src="./company-logo.png" width="60" height="60" alt="Website Logo"></a>
            <div class="mobile-menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-items" type="none">
                <li><a href="/home" class="navopt">Home</a></li>
                <li><a href="/budget" class="navopt">Budget</a></li>
                <li><a href="/split" class="navopt">SplitMate</a></li>
                <li><a href="/contact" class="navopt">Contact</a></li>
                <li><a href="/histroy" class="navopt">History</a></li>
                <li>
                    <button id="profileButton"><img src="./profileicon.png" alt="err" height="40px" width="40px"></button>
                </li>
            </ul>
        </nav>
    </header>
    <div id="profilePopup" class="popup">
        <div class="profile-info" style="text-align: center;">
            <span id="name" class="profile-value" style="color: white;"></span>
        </div>
        <div class="profile-info">
            <span id="email" class="profile-value" style="color: white;"></span>
        </div>

        <div class="profile-info" style="text-align: center;">
            <span id="jobProfile" class="profile-value" style="color: white;"></span>
        </div>

        <div class="profile-info" style="text-align: center;">
            <span id="salary" class="profile-value" style="color: white;"></span>
        </div>

        <button id="logoutButton">Logout</button>
        <button id="deleteButton" class="delete-button">Delete Account</button> 
    </div>
    <div class="container">
        <div id="success-message" style="display: none;"></div>
        <div id="error-message" style="display: none;"></div>
        <h1>SplitMate</h1>
        <form id="expense-form">
            <input type="text" id="group-name" placeholder="Group Name" required>
            <input type="text" id="expense-description" placeholder="Expense Description" required>
            <input type="number" id="expense-amount" placeholder="Amount in INR" required>
            <input type="number" id="num-members" placeholder="Number of Members" required>
            <div id="members-input-container"></div>
            <button type="submit" id="button1">Add Expense & Send Notification</button>
            <div id="loading-message" style="display: none; text-align: center;">Loading, please wait...</div>
        </form>
    </div>
     <!-- Footer -->
     <footer>
        <div class="footer-columns">
            <div class="footer-column1">
                <p>Email: <a href="mailto:#">fincred172@gmail.com</a> </p>
                <p>Phone: <a href="tel:#">+91 2568456239</a> </p>
            </div>
            <div class="footer-column2">
                <ul class="foot-list"> 
                    <li><a href="/home">Home</a></li>
                    <li><a href="/budget">Budget</a></li>
                    <li><a href="/split">SplitMate</a></li>
                    <li><a href="/contact">Contact</a></li>
                    <li><a href="/histroy">History</a></li>
                </ul>
            </div>
            <div class="footer-column3">
                <img src="./company-logo.png" alt="Company Logo" style="width: 70px; height: 70px;">
                <p>FinCred</p>
            </div>
        </div>
    </footer>
    <script src="script.js"></script>
    <script src="script1.js"></script>
    <script>
       // SplitMate
       let lastValidNumMembers = 0; // To keep track of the last valid input

document.getElementById('num-members').addEventListener('input', (e) => {
    const numMembers = parseInt(e.target.value);
    const membersContainer = document.getElementById('members-input-container');
    membersContainer.innerHTML = ''; // Clear previous inputs
    if (numMembers > 20 || numMembers <= 0 || isNaN(numMembers)) {
    let message = numMembers > 20 
        ? 'You can add a maximum of 20 members.' 
        : 'Number of members should be greater than 0.';
        
    alert(message);
    e.target.value = lastValidNumMembers; // Revert to the last valid value
    return;
}

    // Update the last valid input when the current input is correct
    lastValidNumMembers = numMembers;

    // Create email input fields for each member
    for (let i = 0; i < numMembers; i++) {
        const input = document.createElement('input');
        input.type = 'email';
        input.placeholder = `Email of Member ${i + 1}`;
        input.required = true;
        input.className = 'member-email';
        membersContainer.appendChild(input);
    }
});

    // Event listener for form submission to add a shared expense and send notifications
    document.getElementById('expense-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const submitButton = document.getElementById('button1');
        const loadingMessage = document.getElementById('loading-message');
        const successMessage = document.getElementById('success-message');
        const errorMessage = document.getElementById('error-message');

    // Disable the submit button and show loading message
    submitButton.style.display = 'none'; 
    loadingMessage.style.display = 'block'; 
    errorMessage.style.display = 'none'; 
    successMessage.style.display = 'none';

        const groupName = document.getElementById('group-name').value.trim();
        const description = document.getElementById('expense-description').value.trim();
        const amount = parseFloat(document.getElementById('expense-amount').value);
        const emails = Array.from(document.querySelectorAll('.member-email')).map(input => input.value.trim());

        if (amount <= 0) {
            errorMessage.innerHTML = 'Amount should be greater than 0.'; // Set error message
            errorMessage.style.display = 'block'; 
    return;
}
        // // Validate the inputs before making the request
        // if (!groupName || !description || amount <= 0 || emails.some(email => !email)) {
        //     alert('Please ensure all fields are filled in correctly.');
        //     console.error('Validation failed:', { groupName, description, amount, emails });
        //     return;
        // }

        const expenseData = { groupName, description, amount, emails };

        try {
            const response = await fetch('/api/auth/shared-expenses', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(expenseData),
            });

            const result = await response.json();
            if (response.ok) {
                clearForm();
                successMessage.innerHTML = 'Expense added and notifications sent successfully!';
                successMessage.style.display = 'block';
                setTimeout(() => {
                successMessage.style.display = 'none'; 
                    }, 6000);
                
            } else {
                console.error('Error response from server:', result);
                errorMessage.innerHTML = result.message;
                errorMessage.style.display = 'block';
            }
        } catch (error) {
            console.error('Error adding expense and sending notifications:', error);
            errorMessage.innerHTML = 'An error occurred while processing your request.';
            errorMessage.style.display = 'block';
        }

        finally {
        submitButton.style.display = 'block';
        loadingMessage.style.display = 'none';
    }
    });

    function clearForm() {
    
    // Clear static form inputs
    document.getElementById('group-name').value = '';
    document.getElementById('expense-description').value = '';
    document.getElementById('expense-amount').value = '';

    // Clear the num-members input and members emails
    document.getElementById('num-members').value = '';
    const membersContainer = document.getElementById('members-input-container');
    
    // Clear dynamically added email fields
    while (membersContainer.firstChild) {
        membersContainer.removeChild(membersContainer.firstChild);
    }
    document.getElementById('error-message').style.display = 'none';
    document.getElementById('success-message').style.display = 'none';
    
}
document.addEventListener('DOMContentLoaded', function () {
        const mobileMenuIcon = document.querySelector('.mobile-menu-icon');
        const navItems = document.querySelector('.nav-items');
      
        mobileMenuIcon.addEventListener('click', function () {
            navItems.classList.toggle('show');
        });
      });
</script>
</body>
</html>
